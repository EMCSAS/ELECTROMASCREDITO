<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos por Categoría y Subcategoría</title>
</head>
<body>

    <h1>Productos por Categoría y Subcategoría</h1>

    <!-- Listas desplegables -->
    <label for="categoriaSelect">Selecciona una Categoría:</label>
    <select id="categoriaSelect">
        <option value="">--Selecciona una Categoría--</option>
    </select>

    <label for="subcategoriaSelect">Selecciona una Subcategoría:</label>
    <select id="subcategoriaSelect">
        <option value="">--Selecciona una Subcategoría--</option>
    </select>

    <!-- Tabla para mostrar los productos -->
    <table id="productosTable" border="1" style="margin-top: 20px;">
        <thead>
            <tr>
                <th>Categoría</th>
                <th>Subcategoría</th>
                <th>Código SAP</th>
                <th>Descripción</th>
                <th>Precio</th>
            </tr>
        </thead>
        <tbody>
            <!-- Los productos se mostrarán aquí -->
        </tbody>
    </table>

    <script>
        let productos = []; // Para almacenar todos los productos

        // Función para cargar y procesar el archivo CSV
        async function cargarCSV() {
            const response = await fetch('precio.csv');
            const data = await response.text();
            const rows = data.split('\n');
            
            let ultimaCategoria = "";
            let ultimaSubcategoria = "";

            // Procesar las filas del CSV
            rows.forEach((row, index) => {
                if (index === 0) return; // Saltar el encabezado

                const cols = row.split(';');
                let categoria = cols[0].trim();
                let subcategoria = cols[1].trim();
                const codigoSAP = cols[2].trim();
                const descripcion = cols[3].trim();
                const precio = cols[4]?.trim();

                // Si la categoría está vacía, tomar la anterior
                if (!categoria) {
                    categoria = ultimaCategoria;
                } else {
                    ultimaCategoria = categoria;
                }

                // Si la subcategoría está vacía, tomar la anterior
                if (!subcategoria) {
                    subcategoria = ultimaSubcategoria;
                } else {
                    ultimaSubcategoria = subcategoria;
                }

                // Añadir el producto al array de productos
                productos.push({
                    categoria,
                    subcategoria,
                    codigoSAP,
                    descripcion,
                    precio
                });
            });

            // Llenar las categorías en el select
            llenarCategorias();
        }

        // Función para llenar el select de categorías
        function llenarCategorias() {
            const categoriaSelect = document.getElementById('categoriaSelect');
            const categorias = [...new Set(productos.map(p => p.categoria))]; // Obtener categorías únicas

            categorias.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                categoriaSelect.appendChild(option);
            });

            // Agregar evento para cuando se selecciona una categoría
            categoriaSelect.addEventListener('change', llenarSubcategorias);
        }

        // Función para llenar el select de subcategorías según la categoría seleccionada
        function llenarSubcategorias() {
            const subcategoriaSelect = document.getElementById('subcategoriaSelect');
            const categoriaSeleccionada = document.getElementById('categoriaSelect').value;

            // Limpiar el select de subcategorías
            subcategoriaSelect.innerHTML = '<option value="">--Selecciona una Subcategoría--</option>';

            // Filtrar subcategorías por categoría seleccionada
            const subcategorias = [...new Set(productos
                .filter(p => p.categoria === categoriaSeleccionada)
                .map(p => p.subcategoria))]; // Obtener subcategorías únicas

            // Llenar el select de subcategorías
            subcategorias.forEach(subcategoria => {
                const option = document.createElement('option');
                option.value = subcategoria;
                option.textContent = subcategoria;
                subcategoriaSelect.appendChild(option);
            });

            // Agregar evento para cuando se selecciona una subcategoría
            subcategoriaSelect.addEventListener('change', mostrarProductos);
        }

        // Función para mostrar los productos según la subcategoría seleccionada
        function mostrarProductos() {
            const categoriaSeleccionada = document.getElementById('categoriaSelect').value;
            const subcategoriaSeleccionada = document.getElementById('subcategoriaSelect').value;
            const tbody = document.getElementById('productosTable').querySelector('tbody');

            // Limpiar la tabla de productos
            tbody.innerHTML = '';

            // Filtrar los productos por categoría y subcategoría seleccionadas
            const productosFiltrados = productos.filter(p => 
                p.categoria === categoriaSeleccionada && p.subcategoria === subcategoriaSeleccionada
            );

            // Mostrar los productos en la tabla
            productosFiltrados.forEach(producto => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${producto.categoria}</td>
                    <td>${producto.subcategoria}</td>
                    <td>${producto.codigoSAP}</td>
                    <td>${producto.descripcion}</td>
                    <td>${producto.precio}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Llamar a la función para cargar y procesar el CSV
        cargarCSV();
    </script>

</body>
</html>
